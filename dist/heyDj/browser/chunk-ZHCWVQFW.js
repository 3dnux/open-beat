import{a as p}from"./chunk-YJ67FVZQ.js";import{a as d}from"./chunk-S6MXMXK4.js";import"./chunk-T2NSUFSZ.js";import"./chunk-32IAVZSY.js";import{a as c}from"./chunk-MFSGMIY7.js";import"./chunk-ACEJN2MV.js";import"./chunk-EEENIMDP.js";import"./chunk-XQMGIZNC.js";import{A as l,l as r,m as k,n as i,v as N}from"./chunk-DKJ7BJEZ.js";import{e as F,f as o}from"./chunk-EQVTEUXC.js";var I=F(N(),1);var s={len:12,get:(t,e)=>({id:c.get(t,e),size:k.get(t,e+4)})},u={len:16,get:(t,e)=>({fileSize:i.get(t,e),metadataPointer:i.get(t,e+8)})};var T={len:40,get:(t,e)=>({formatVersion:r.get(t,e),formatID:r.get(t,e+4),channelType:r.get(t,e+8),channelNum:r.get(t,e+12),samplingFrequency:r.get(t,e+16),bitsPerSample:r.get(t,e+20),sampleCount:i.get(t,e+24),blockSizePerChannel:r.get(t,e+32)})};var m=(0,I.default)("music-metadata:parser:DSF"),h=class extends l("DSD"){},g=class extends p{postId3v2Parse(){return o(this,null,function*(){let e=this.tokenizer.position,n=yield this.tokenizer.readToken(s);if(n.id!=="DSD ")throw new h("Invalid chunk signature");this.metadata.setFormat("container","DSF"),this.metadata.setFormat("lossless",!0),this.metadata.setAudioOnly();let a=yield this.tokenizer.readToken(u);if(a.metadataPointer===BigInt(0))m("No ID3v2 tag present");else return m(`expect ID3v2 at offset=${a.metadataPointer}`),yield this.parseChunks(a.fileSize-n.size),yield this.tokenizer.ignore(Number(a.metadataPointer)-this.tokenizer.position-e),new d().parse(this.metadata,this.tokenizer,this.options)})}parseChunks(e){return o(this,null,function*(){for(;e>=s.len;){let n=yield this.tokenizer.readToken(s);switch(m(`Parsing chunk name=${n.id} size=${n.size}`),n.id){case"fmt ":{let a=yield this.tokenizer.readToken(T);this.metadata.setFormat("numberOfChannels",a.channelNum),this.metadata.setFormat("sampleRate",a.samplingFrequency),this.metadata.setFormat("bitsPerSample",a.bitsPerSample),this.metadata.setFormat("numberOfSamples",a.sampleCount),this.metadata.setFormat("duration",Number(a.sampleCount)/a.samplingFrequency);let z=a.bitsPerSample*a.samplingFrequency*a.channelNum;this.metadata.setFormat("bitrate",z);return}default:this.tokenizer.ignore(Number(n.size)-s.len);break}e-=n.size}})}};export{h as DsdContentParseError,g as DsfParser};
